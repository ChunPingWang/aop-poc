# 聯絡人管理系統 - 產品需求規格書 (PRD)

## 1. 文件資訊

| 項目 | 內容 |
|------|------|
| 文件版本 | 1.0 |
| 建立日期 | 2026-01-09 |
| 產品名稱 | Contact Management System |
| 專案代號 | CMS-2026 |

---

## 2. 產品概述

### 2.1 產品願景

建立一個簡潔、可靠的聯絡人管理系統，提供標準化的 RESTful API 介面，支援聯絡人資料的完整生命週期管理，並具備完善的稽核日誌機制以滿足資料追蹤與合規需求。

### 2.2 目標用戶

- 需要管理聯絡人資料的應用系統
- 需要整合聯絡人服務的第三方系統
- 系統管理員（稽核日誌查詢）

### 2.3 核心價值

1. **簡單易用**：標準 RESTful API 設計，降低整合成本
2. **資料完整**：完整的 CRUD 操作支援
3. **可追溯性**：全面的稽核日誌記錄，滿足合規要求
4. **可視化**：內建資料庫管理介面，便於開發與除錯

---

## 3. 功能需求

### 3.1 聯絡人管理功能

#### 3.1.1 新增聯絡人 (Create)

| 項目 | 說明 |
|------|------|
| 功能描述 | 建立新的聯絡人記錄 |
| 輸入欄位 | 姓名（必填）、電話（必填）、地址（選填） |
| 輸出結果 | 新建聯絡人完整資訊（含系統產生的 ID） |
| 業務規則 | BR-001: 姓名不可為空白<br>BR-002: 電話格式需符合規範 |

#### 3.1.2 查詢聯絡人 (Read)

| 項目 | 說明 |
|------|------|
| 功能描述 | 查詢聯絡人資料 |
| 查詢方式 | 單筆查詢（by ID）、全部查詢 |
| 輸出結果 | 聯絡人資訊或聯絡人列表 |
| 業務規則 | BR-003: 查無資料時回傳適當訊息 |

#### 3.1.3 修改聯絡人 (Update)

| 項目 | 說明 |
|------|------|
| 功能描述 | 更新現有聯絡人資料 |
| 輸入欄位 | ID（必填）、姓名、電話、地址 |
| 輸出結果 | 更新後的聯絡人完整資訊 |
| 業務規則 | BR-004: 聯絡人必須存在才能修改<br>BR-005: 至少需更新一個欄位 |

#### 3.1.4 刪除聯絡人 (Delete)

| 項目 | 說明 |
|------|------|
| 功能描述 | 刪除指定的聯絡人記錄 |
| 輸入欄位 | ID（必填） |
| 輸出結果 | 刪除成功/失敗訊息 |
| 業務規則 | BR-006: 聯絡人必須存在才能刪除 |

### 3.2 稽核日誌功能

#### 3.2.1 自動記錄稽核日誌

| 項目 | 說明 |
|------|------|
| 功能描述 | 自動記錄所有 API 呼叫的稽核資訊 |
| 記錄時機 | 每次 API 被呼叫時自動觸發 |
| 記錄內容 | 操作時間、操作類型、API 端點、請求參數、回應狀態、執行時間、操作者 IP |

#### 3.2.2 稽核日誌查詢

提供多種查詢方式以滿足不同場景需求：

| 查詢方式 | 說明 | 使用場景 |
|----------|------|----------|
| 依時間範圍查詢 | 查詢指定時間區間內的日誌 | 定期稽核報告、問題調查 |
| 依操作類型查詢 | 查詢特定操作（CREATE/READ/UPDATE/DELETE）的日誌 | 追蹤特定類型操作 |
| 依 API 端點查詢 | 查詢特定 API 的呼叫記錄 | API 使用分析 |
| 依操作者 IP 查詢 | 查詢特定來源 IP 的操作記錄 | 安全稽核、異常追蹤 |
| 綜合條件查詢 | 組合多個條件進行查詢 | 複雜稽核需求 |

### 3.3 資料庫管理介面

| 項目 | 說明 |
|------|------|
| 功能描述 | 提供 Web 介面查看資料庫內容 |
| 存取方式 | 瀏覽器存取 H2 Console |
| 主要用途 | 開發除錯、資料驗證、快速查詢 |

---

## 4. 資料規格

### 4.1 聯絡人資料模型

| 欄位名稱 | 欄位說明 | 資料類型 | 必填 | 驗證規則 |
|----------|----------|----------|------|----------|
| id | 系統識別碼 | Long | 是（自動產生） | 系統自動產生 |
| name | 姓名 | String | 是 | 長度 1-50 字元 |
| phone | 電話 | String | 是 | 長度 1-20 字元 |
| address | 地址 | String | 否 | 長度 0-200 字元 |
| createdAt | 建立時間 | DateTime | 是（自動產生） | 系統自動產生 |
| updatedAt | 更新時間 | DateTime | 是（自動產生） | 系統自動更新 |

### 4.2 稽核日誌資料模型

| 欄位名稱 | 欄位說明 | 資料類型 |
|----------|----------|----------|
| id | 日誌識別碼 | Long |
| timestamp | 操作時間 | DateTime |
| action | 操作類型 | String (CREATE/READ/UPDATE/DELETE) |
| endpoint | API 端點 | String |
| method | HTTP 方法 | String (GET/POST/PUT/DELETE) |
| requestBody | 請求內容 | String (JSON) |
| responseStatus | 回應狀態碼 | Integer |
| executionTime | 執行時間（毫秒） | Long |
| clientIp | 操作者 IP | String |
| userAgent | 用戶代理 | String |

---

## 5. 非功能性需求

### 5.1 效能需求

| 項目 | 指標 |
|------|------|
| API 回應時間 | 平均 < 200ms |
| 稽核日誌寫入 | 非同步處理，不影響主要業務回應時間 |

### 5.2 可用性需求

| 項目 | 指標 |
|------|------|
| 系統可用性 | 開發/測試環境，無 SLA 要求 |
| 資料持久性 | H2 記憶體模式，重啟後資料清除 |

### 5.3 安全性需求

| 項目 | 說明 |
|------|------|
| 稽核追蹤 | 所有 API 操作皆需記錄 |
| 資料驗證 | 所有輸入需進行基本驗證 |

---

## 6. 使用案例

### UC-001: 新增聯絡人

```
前置條件：無
觸發事件：用戶呼叫新增 API
主要流程：
  1. 用戶發送新增請求（含姓名、電話、地址）
  2. 系統驗證輸入資料
  3. 系統建立聯絡人記錄
  4. 系統記錄稽核日誌
  5. 系統回傳新建聯絡人資訊
後置條件：聯絡人記錄已建立，稽核日誌已記錄
例外流程：
  - 2a. 驗證失敗：回傳錯誤訊息
```

### UC-002: 查詢聯絡人

```
前置條件：無
觸發事件：用戶呼叫查詢 API
主要流程：
  1. 用戶發送查詢請求（可選擇性帶入 ID）
  2. 系統查詢聯絡人資料
  3. 系統記錄稽核日誌
  4. 系統回傳查詢結果
後置條件：稽核日誌已記錄
例外流程：
  - 2a. 指定 ID 不存在：回傳查無資料訊息
```

### UC-003: 修改聯絡人

```
前置條件：聯絡人記錄存在
觸發事件：用戶呼叫修改 API
主要流程：
  1. 用戶發送修改請求（含 ID 與更新欄位）
  2. 系統驗證聯絡人存在
  3. 系統驗證輸入資料
  4. 系統更新聯絡人記錄
  5. 系統記錄稽核日誌
  6. 系統回傳更新後聯絡人資訊
後置條件：聯絡人記錄已更新，稽核日誌已記錄
例外流程：
  - 2a. 聯絡人不存在：回傳錯誤訊息
  - 3a. 驗證失敗：回傳錯誤訊息
```

### UC-004: 刪除聯絡人

```
前置條件：聯絡人記錄存在
觸發事件：用戶呼叫刪除 API
主要流程：
  1. 用戶發送刪除請求（含 ID）
  2. 系統驗證聯絡人存在
  3. 系統刪除聯絡人記錄
  4. 系統記錄稽核日誌
  5. 系統回傳刪除成功訊息
後置條件：聯絡人記錄已刪除，稽核日誌已記錄
例外流程：
  - 2a. 聯絡人不存在：回傳錯誤訊息
```

### UC-005: 查詢稽核日誌

```
前置條件：無
觸發事件：管理員呼叫稽核日誌查詢 API
主要流程：
  1. 管理員發送查詢請求（含查詢條件）
  2. 系統根據條件查詢稽核日誌
  3. 系統回傳查詢結果
後置條件：無
例外流程：
  - 2a. 查無符合條件的日誌：回傳空列表
```

---

## 7. API 端點規劃

### 7.1 聯絡人 API

| 操作 | HTTP Method | 端點 |
|------|-------------|------|
| 新增聯絡人 | POST | /api/contacts |
| 查詢所有聯絡人 | GET | /api/contacts |
| 查詢單一聯絡人 | GET | /api/contacts/{id} |
| 修改聯絡人 | PUT | /api/contacts/{id} |
| 刪除聯絡人 | DELETE | /api/contacts/{id} |

### 7.2 稽核日誌 API

| 操作 | HTTP Method | 端點 |
|------|-------------|------|
| 查詢所有日誌 | GET | /api/audit-logs |
| 依時間範圍查詢 | GET | /api/audit-logs?startTime={}&endTime={} |
| 依操作類型查詢 | GET | /api/audit-logs?action={action} |
| 依 API 端點查詢 | GET | /api/audit-logs?endpoint={endpoint} |
| 依 IP 查詢 | GET | /api/audit-logs?clientIp={ip} |
| 查詢單一日誌 | GET | /api/audit-logs/{id} |

---

## 8. 驗收標準

### 8.1 功能驗收

- [ ] 可成功新增聯絡人並取得回傳結果
- [ ] 可查詢所有聯絡人列表
- [ ] 可依 ID 查詢單一聯絡人
- [ ] 可成功修改聯絡人資料
- [ ] 可成功刪除聯絡人
- [ ] 每個 API 呼叫都有對應的稽核日誌
- [ ] 可依各種條件查詢稽核日誌
- [ ] H2 Console 可正常存取並查看資料

### 8.2 非功能驗收

- [ ] API 回應格式符合 RESTful 規範
- [ ] 錯誤訊息清楚明確
- [ ] 稽核日誌記錄完整

---

## 附錄 A: 術語定義

| 術語 | 定義 |
|------|------|
| 聯絡人 | 系統中管理的人員資料實體 |
| 稽核日誌 | 記錄系統操作行為的日誌記錄 |
| CRUD | Create, Read, Update, Delete 的縮寫 |
| RESTful | 一種 Web API 設計風格 |
