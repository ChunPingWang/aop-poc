# Feature Specification: Contact Management System

**Feature Branch**: `001-contact-management`
**Created**: 2026-01-09
**Status**: Draft
**Input**: PRD.md - 聯絡人管理系統產品需求規格書

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 新增聯絡人 (Priority: P1)

作為一個需要管理聯絡人資料的應用系統，我希望能夠建立新的聯絡人記錄，以便儲存和追蹤重要的聯絡資訊。

**Why this priority**: 新增是所有 CRUD 操作的基礎，沒有資料就無法進行其他操作。這是系統最核心的功能。

**Independent Test**: 可透過發送新增請求並驗證回傳的聯絡人資訊來完全測試，提供儲存聯絡人資料的核心價值。

**Acceptance Scenarios**:

1. **Given** 系統正常運作且無任何聯絡人, **When** 使用者提供姓名「張三」、電話「0912345678」、地址「台北市中正區」發送新增請求, **Then** 系統回傳包含系統產生 ID 的完整聯絡人資訊，且資料已被持久化
2. **Given** 系統正常運作, **When** 使用者提供姓名「李四」、電話「0987654321」但不提供地址發送新增請求, **Then** 系統回傳包含系統產生 ID 的聯絡人資訊，地址欄位為空
3. **Given** 系統正常運作, **When** 使用者提供空白姓名發送新增請求, **Then** 系統回傳驗證錯誤訊息，說明姓名為必填欄位
4. **Given** 系統正常運作, **When** 使用者未提供電話發送新增請求, **Then** 系統回傳驗證錯誤訊息，說明電話為必填欄位

---

### User Story 2 - 查詢聯絡人 (Priority: P1)

作為一個需要存取聯絡人資料的應用系統，我希望能夠查詢聯絡人記錄（單筆或全部），以便取得需要的聯絡資訊。

**Why this priority**: 查詢與新增同為 P1，因為讀取資料是系統被整合的主要目的之一，且無查詢功能則新增後無法驗證結果。

**Independent Test**: 可透過先新增測試資料，再發送查詢請求並驗證回傳結果來測試，提供資料存取的核心價值。

**Acceptance Scenarios**:

1. **Given** 系統中已存在 ID 為 1 的聯絡人「張三」, **When** 使用者以 ID=1 發送查詢請求, **Then** 系統回傳該聯絡人的完整資訊
2. **Given** 系統中已存在多筆聯絡人記錄, **When** 使用者發送查詢所有聯絡人請求, **Then** 系統回傳所有聯絡人的列表
3. **Given** 系統中無任何聯絡人記錄, **When** 使用者發送查詢所有聯絡人請求, **Then** 系統回傳空列表
4. **Given** 系統中不存在 ID 為 999 的聯絡人, **When** 使用者以 ID=999 發送查詢請求, **Then** 系統回傳查無資料的適當訊息

---

### User Story 3 - 修改聯絡人 (Priority: P2)

作為一個需要維護聯絡人資料的應用系統，我希望能夠更新現有聯絡人的資料，以便保持資料的正確性與時效性。

**Why this priority**: 修改功能對於資料維護很重要，但優先級略低於新增和查詢，因為系統可以在沒有修改功能的情況下提供基本價值。

**Independent Test**: 可透過先新增測試資料，再發送修改請求並驗證更新後的資料來測試，提供資料維護的價值。

**Acceptance Scenarios**:

1. **Given** 系統中存在 ID 為 1 的聯絡人「張三」, **When** 使用者發送修改請求將姓名改為「張三豐」, **Then** 系統回傳更新後的聯絡人資訊，姓名已變更且更新時間已更新
2. **Given** 系統中存在 ID 為 1 的聯絡人, **When** 使用者發送修改請求同時更新電話和地址, **Then** 系統回傳更新後的聯絡人資訊，兩個欄位皆已變更
3. **Given** 系統中不存在 ID 為 999 的聯絡人, **When** 使用者發送修改 ID=999 的請求, **Then** 系統回傳錯誤訊息，說明聯絡人不存在

---

### User Story 4 - 刪除聯絡人 (Priority: P2)

作為一個需要管理聯絡人資料的應用系統，我希望能夠刪除不再需要的聯絡人記錄，以便維持資料的整潔。

**Why this priority**: 刪除功能對於資料生命週期管理很重要，但優先級略低於新增和查詢。

**Independent Test**: 可透過先新增測試資料，再發送刪除請求並驗證資料已被移除來測試。

**Acceptance Scenarios**:

1. **Given** 系統中存在 ID 為 1 的聯絡人, **When** 使用者發送刪除 ID=1 的請求, **Then** 系統回傳刪除成功訊息，且該聯絡人已從系統中移除
2. **Given** 系統中不存在 ID 為 999 的聯絡人, **When** 使用者發送刪除 ID=999 的請求, **Then** 系統回傳錯誤訊息，說明聯絡人不存在

---

### User Story 5 - 稽核日誌自動記錄 (Priority: P2)

作為系統管理員，我希望所有 API 操作都能自動記錄稽核日誌，以便追蹤系統使用情況並滿足合規要求。

**Why this priority**: 稽核日誌是合規性和系統追蹤的重要功能，但不影響核心的聯絡人管理功能。

**Independent Test**: 可透過執行任意聯絡人 API 操作後，驗證稽核日誌是否正確記錄來測試。

**Acceptance Scenarios**:

1. **Given** 系統正常運作, **When** 使用者執行新增聯絡人操作, **Then** 系統自動記錄包含操作時間、操作類型(CREATE)、API 端點、請求參數、回應狀態、執行時間、操作者 IP 的稽核日誌
2. **Given** 系統正常運作, **When** 使用者執行查詢聯絡人操作, **Then** 系統自動記錄操作類型為 READ 的稽核日誌
3. **Given** 系統正常運作, **When** 使用者執行修改聯絡人操作, **Then** 系統自動記錄操作類型為 UPDATE 的稽核日誌
4. **Given** 系統正常運作, **When** 使用者執行刪除聯絡人操作, **Then** 系統自動記錄操作類型為 DELETE 的稽核日誌
5. **Given** 系統正常運作, **When** 使用者執行操作但發生錯誤, **Then** 系統仍記錄稽核日誌，包含錯誤的回應狀態碼

---

### User Story 6 - 稽核日誌查詢 (Priority: P3)

作為系統管理員，我希望能夠依據各種條件查詢稽核日誌，以便進行系統分析、問題調查和合規審計。

**Why this priority**: 稽核日誌查詢對於系統管理很有價值，但是比核心 CRUD 和自動記錄功能優先級低。

**Independent Test**: 可透過先產生稽核日誌（執行聯絡人操作），再發送查詢請求並驗證結果來測試。

**Acceptance Scenarios**:

1. **Given** 系統中已存在多筆稽核日誌, **When** 管理員發送查詢所有日誌請求, **Then** 系統回傳所有稽核日誌列表
2. **Given** 系統中存在不同時間的稽核日誌, **When** 管理員以時間範圍條件查詢, **Then** 系統回傳該時間範圍內的日誌
3. **Given** 系統中存在不同操作類型的稽核日誌, **When** 管理員以操作類型 CREATE 查詢, **Then** 系統僅回傳 CREATE 類型的日誌
4. **Given** 系統中存在不同 API 端點的稽核日誌, **When** 管理員以特定端點查詢, **Then** 系統僅回傳該端點的日誌
5. **Given** 系統中存在來自不同 IP 的稽核日誌, **When** 管理員以特定 IP 查詢, **Then** 系統僅回傳該 IP 的操作日誌
6. **Given** 系統中存在稽核日誌, **When** 管理員組合多個條件查詢, **Then** 系統回傳符合所有條件的日誌

---

### User Story 7 - 資料庫管理介面 (Priority: P3)

作為開發人員，我希望能夠透過 Web 介面查看資料庫內容，以便進行開發除錯和資料驗證。

**Why this priority**: 這是開發輔助功能，對於最終產品價值影響較低，但對開發效率有幫助。

**Independent Test**: 可透過存取資料庫管理介面並執行查詢來測試。

**Acceptance Scenarios**:

1. **Given** 系統正常運作, **When** 開發人員透過瀏覽器存取資料庫管理介面, **Then** 系統顯示資料庫管理頁面
2. **Given** 開發人員已進入資料庫管理介面, **When** 執行查詢聯絡人資料表的 SQL, **Then** 系統顯示聯絡人資料內容
3. **Given** 開發人員已進入資料庫管理介面, **When** 執行查詢稽核日誌資料表的 SQL, **Then** 系統顯示稽核日誌資料內容

---

### Edge Cases

- 當姓名長度超過 50 字元時，系統回傳驗證錯誤
- 當電話長度超過 20 字元時，系統回傳驗證錯誤
- 當地址長度超過 200 字元時，系統回傳驗證錯誤
- 當同時發送多個相同的新增請求時，系統應正確處理並發情況
- 當稽核日誌寫入失敗時，不應影響主要業務操作的回應
- 當查詢大量稽核日誌時，系統應支援分頁以避免效能問題

## Requirements *(mandatory)*

### Functional Requirements

**聯絡人管理**

- **FR-001**: 系統 MUST 允許建立新的聯絡人記錄，包含姓名（必填）、電話（必填）、地址（選填）
- **FR-002**: 系統 MUST 為每個新建聯絡人自動產生唯一識別碼
- **FR-003**: 系統 MUST 自動記錄聯絡人的建立時間和更新時間
- **FR-004**: 系統 MUST 驗證姓名長度在 1-50 字元之間
- **FR-005**: 系統 MUST 驗證電話長度在 1-20 字元之間
- **FR-006**: 系統 MUST 驗證地址長度不超過 200 字元（若有提供）
- **FR-007**: 系統 MUST 支援依識別碼查詢單一聯絡人
- **FR-008**: 系統 MUST 支援查詢所有聯絡人列表
- **FR-009**: 系統 MUST 支援更新現有聯絡人的姓名、電話、地址
- **FR-010**: 系統 MUST 在更新聯絡人時自動更新「更新時間」欄位
- **FR-011**: 系統 MUST 支援刪除指定識別碼的聯絡人
- **FR-012**: 系統 MUST 在聯絡人不存在時回傳適當的錯誤訊息

**稽核日誌**

- **FR-013**: 系統 MUST 為每個 API 呼叫自動記錄稽核日誌
- **FR-014**: 稽核日誌 MUST 包含：操作時間、操作類型、API 端點、HTTP 方法、請求內容、回應狀態碼、執行時間、操作者 IP、用戶代理
- **FR-015**: 稽核日誌記錄 MUST 非同步處理，不影響主要業務回應時間
- **FR-016**: 系統 MUST 支援查詢所有稽核日誌
- **FR-017**: 系統 MUST 支援依時間範圍查詢稽核日誌
- **FR-018**: 系統 MUST 支援依操作類型（CREATE/READ/UPDATE/DELETE）查詢稽核日誌
- **FR-019**: 系統 MUST 支援依 API 端點查詢稽核日誌
- **FR-020**: 系統 MUST 支援依操作者 IP 查詢稽核日誌
- **FR-021**: 系統 MUST 支援組合多個條件查詢稽核日誌

**資料庫管理介面**

- **FR-022**: 系統 MUST 提供 Web 介面供開發人員查看資料庫內容

### Key Entities

- **聯絡人 (Contact)**: 系統管理的人員資料實體，具有唯一識別碼、姓名、電話、地址、建立時間、更新時間等屬性
- **稽核日誌 (AuditLog)**: 記錄系統操作行為的日誌實體，具有識別碼、操作時間、操作類型、API 端點、HTTP 方法、請求內容、回應狀態、執行時間、操作者 IP、用戶代理等屬性

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 使用者可在 2 秒內完成新增聯絡人操作
- **SC-002**: 使用者可在 1 秒內取得單一聯絡人查詢結果
- **SC-003**: 使用者可在 2 秒內取得聯絡人列表（100 筆以內）
- **SC-004**: 系統回應時間平均低於 200 毫秒
- **SC-005**: 每個 API 操作都有對應的稽核日誌記錄（100% 記錄率）
- **SC-006**: 稽核日誌記錄不影響主要操作的回應時間（額外延遲低於 10%）
- **SC-007**: 資料庫管理介面可正常存取並執行查詢
- **SC-008**: 所有輸入驗證錯誤都回傳清楚明確的錯誤訊息
- **SC-009**: API 回應格式符合 RESTful 規範

## Assumptions

- 系統為開發/測試環境使用，採用記憶體模式資料庫，重啟後資料清除
- 無需使用者認證機制，所有 API 開放存取
- 電話欄位不需驗證特定格式，僅驗證長度
- 稽核日誌無需長期保存策略，與主資料生命週期相同
- 單一部署環境，無需考慮分散式架構
